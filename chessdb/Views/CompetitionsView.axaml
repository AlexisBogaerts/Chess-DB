<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:chessdb.ViewModels"
             xmlns:m="using:chessdb.Models"
             x:Class="chessdb.Views.CompetitionsView"
             x:DataType="vm:CompetitionsViewModel">

  <Grid ColumnDefinitions="*,*,*">
    
    <!-- Liste des compÃ©titions -->
    <Border Grid.Column="0" 
            Background="White" 
            CornerRadius="8" 
            Padding="20"
            Margin="0,0,10,0"
            BoxShadow="0 2 8 0 #10000000">
      <Grid RowDefinitions="Auto,Auto,*,Auto">
        
        <TextBlock Grid.Row="0" 
                   Text="CompÃ©titions" 
                   FontSize="18" 
                   FontWeight="Bold"
                   Margin="0,0,0,15"/>

        <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,0,0,15">
          <TextBlock Text="Total: " Foreground="Gray"/>
          <TextBlock Text="{Binding Competitions.Count}" FontWeight="Bold"/>
        </StackPanel>

        <ListBox Grid.Row="2"
                 ItemsSource="{Binding Competitions}" 
                 SelectedItem="{Binding SelectedCompetition}"
                 Background="Transparent">
          <ListBox.ItemTemplate>
            <DataTemplate x:DataType="m:Competition">
              <Border Padding="12" BorderBrush="#E0E0E0" BorderThickness="0,0,0,1">
                <StackPanel>
                  <TextBlock Text="{Binding Name}" 
                             FontWeight="Bold" 
                             FontSize="14"/>
                  <TextBlock Foreground="Gray" FontSize="12" Margin="0,4,0,0">
                    <Run Text="ðŸ“…"/>
                    <Run Text="{Binding StartDate, StringFormat={}{0:dd/MM/yyyy}}"/>
                    <Run Text=" - "/>
                    <Run Text="{Binding EndDate, StringFormat={}{0:dd/MM/yyyy}}"/>
                  </TextBlock>
                </StackPanel>
              </Border>
            </DataTemplate>
          </ListBox.ItemTemplate>
        </ListBox>

        <StackPanel Grid.Row="3" 
                    Orientation="Horizontal" 
                    HorizontalAlignment="Right"
                    Margin="0,15,0,0"
                    Spacing="10">
          <Button Content="âž• Nouvelle" 
                  Command="{Binding NewCompetitionCommand}"
                  Background="#27AE60"
                  Foreground="White"
                  Padding="15,8"/>
          <Button Content="âœï¸ Modifier" 
                  Command="{Binding EditCompetitionCommand}"
                  IsEnabled="{Binding SelectedCompetition, Converter={x:Static ObjectConverters.IsNotNull}}"
                  Background="#3498DB"
                  Foreground="White"
                  Padding="15,8"/>
          <Button Content="ðŸ—‘ï¸ Supprimer" 
                  Command="{Binding DeleteCompetitionCommand}"
                  IsEnabled="{Binding SelectedCompetition, Converter={x:Static ObjectConverters.IsNotNull}}"
                  Background="#E74C3C"
                  Foreground="White"
                  Padding="15,8"/>
        </StackPanel>
      </Grid>
    </Border>

    <!-- Joueurs inscrits -->
    <Border Grid.Column="1" 
            Background="White" 
            CornerRadius="8" 
            Padding="20"
            Margin="5,0"
            BoxShadow="0 2 8 0 #10000000"
            IsVisible="{Binding SelectedCompetition, Converter={x:Static ObjectConverters.IsNotNull}}">
      <Grid RowDefinitions="Auto,*,Auto">
        
        <TextBlock Grid.Row="0" 
                   Text="Joueurs inscrits" 
                   FontSize="18" 
                   FontWeight="Bold"
                   Margin="0,0,0,15"/>

        <ListBox Grid.Row="1"
                 ItemsSource="{Binding RegisteredPlayers}"
                 SelectedItem="{Binding SelectedRegisteredPlayer}"
                 Background="Transparent">
          <ListBox.ItemTemplate>
            <DataTemplate x:DataType="m:Player">
              <Border Padding="10" BorderBrush="#E0E0E0" BorderThickness="0,0,0,1">
                <Grid ColumnDefinitions="*,Auto">
                  <TextBlock Grid.Column="0">
                    <Run Text="{Binding FirstName}"/>
                    <Run Text=" "/>
                    <Run Text="{Binding LastName}"/>
                  </TextBlock>
                  <TextBlock Grid.Column="1" 
                             Text="{Binding Elo}" 
                             Foreground="#3498DB"
                             FontWeight="Bold"/>
                </Grid>
              </Border>
            </DataTemplate>
          </ListBox.ItemTemplate>
        </ListBox>

        <Button Grid.Row="2"
                Content="âž– DÃ©sinscrire"
                Command="{Binding UnregisterPlayerCommand}"
                IsEnabled="{Binding SelectedRegisteredPlayer, Converter={x:Static ObjectConverters.IsNotNull}}"
                Background="#E74C3C"
                Foreground="White"
                HorizontalAlignment="Stretch"
                Margin="0,15,0,0"
                Padding="10"/>
      </Grid>
    </Border>

    <!-- Joueurs disponibles ou formulaire - CORRECTION ICI -->
    <Border Grid.Column="2" 
            Background="White" 
            CornerRadius="8" 
            Padding="20"
            Margin="10,0,0,0"
            BoxShadow="0 2 8 0 #10000000">
      
      <!-- IMPORTANT: Un seul conteneur racine dans le Border -->
      <Panel>
        <!-- Formulaire d'Ã©dition -->
        <ScrollViewer IsVisible="{Binding IsEditing}">
          <StackPanel Spacing="15">
            <TextBlock Text="Informations" 
                       FontSize="18" 
                       FontWeight="Bold"
                       Margin="0,0,0,10"/>

            <StackPanel>
              <TextBlock Text="Nom *" Margin="0,0,0,5"/>
              <TextBox Text="{Binding Name}" Watermark="Nom de la compÃ©tition"/>
            </StackPanel>

            <StackPanel>
              <TextBlock Text="Date de dÃ©but" Margin="0,0,0,5"/>
              <DatePicker SelectedDate="{Binding StartDate}"/>
            </StackPanel>

            <StackPanel>
              <TextBlock Text="Date de fin" Margin="0,0,0,5"/>
              <DatePicker SelectedDate="{Binding EndDate}"/>
            </StackPanel>

            <StackPanel Orientation="Horizontal" 
                        HorizontalAlignment="Right"
                        Spacing="10"
                        Margin="0,20,0,0">
              <Button Content="Annuler" 
                      Command="{Binding CancelEditCommand}"
                      Padding="15,8"/>
              <Button Content="ðŸ’¾ Enregistrer" 
                      Command="{Binding SaveCompetitionCommand}"
                      Background="#27AE60"
                      Foreground="White"
                      Padding="15,8"/>
            </StackPanel>
          </StackPanel>
        </ScrollViewer>

        <!-- Liste des joueurs Ã  inscrire -->
        <Grid IsVisible="{Binding !IsEditing}" RowDefinitions="Auto,*,Auto">
          <TextBlock Grid.Row="0" 
                     Text="Ajouter des joueurs" 
                     FontSize="18" 
                     FontWeight="Bold"
                     Margin="0,0,0,15"/>

          <ListBox Grid.Row="1"
                   ItemsSource="{Binding AvailablePlayers}"
                   SelectedItem="{Binding SelectedAvailablePlayer}"
                   Background="Transparent">
            <ListBox.ItemTemplate>
              <DataTemplate x:DataType="m:Player">
                <Border Padding="10" BorderBrush="#E0E0E0" BorderThickness="0,0,0,1">
                  <Grid ColumnDefinitions="*,Auto">
                    <TextBlock Grid.Column="0">
                      <Run Text="{Binding FirstName}"/>
                      <Run Text=" "/>
                      <Run Text="{Binding LastName}"/>
                    </TextBlock>
                    <TextBlock Grid.Column="1" 
                               Text="{Binding Elo}" 
                               Foreground="#3498DB"
                               FontWeight="Bold"/>
                  </Grid>
                </Border>
              </DataTemplate>
            </ListBox.ItemTemplate>
          </ListBox>

          <Button Grid.Row="2"
                  Content="âž• Inscrire"
                  Command="{Binding RegisterPlayerCommand}"
                  IsEnabled="{Binding SelectedAvailablePlayer, Converter={x:Static ObjectConverters.IsNotNull}}"
                  Background="#27AE60"
                  Foreground="White"
                  HorizontalAlignment="Stretch"
                  Margin="0,15,0,0"
                  Padding="10"/>
        </Grid>
      </Panel>
    </Border>
  </Grid>
</UserControl>